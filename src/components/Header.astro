---
// Guardian Reinsurance Header - Premium Refined Design
import { getNavigation } from '../lib/navigation';

const navigation = await getNavigation();
const currentPath = Astro.url.pathname;
---

<header class="sticky top-0 z-50 bg-white border-b border-gray-100 no-print">
  <!-- Premium Top Bar - Refined & Minimal -->
  <div class="bg-guardian-green">
    <div class="container flex items-center justify-between py-2">
      <div class="flex items-center gap-2 text-white/90">
        <div class="w-1.5 h-1.5 rounded-full bg-guardian-gold animate-pulse"></div>
        <span class="text-xs tracking-wide uppercase font-medium">Zambia's First Licensed Reinsurance Broker</span>
      </div>
      <div class="hidden sm:flex items-center gap-2 text-xs">
        <span class="text-white/60">In partnership with</span>
        <a
          href="https://www.minerva.co.zw/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-guardian-gold font-semibold hover:text-white transition-colors"
        >
          Minerva Re
        </a>
      </div>
    </div>
  </div>

  <!-- Main Navigation -->
  <nav class="container" aria-label="Main navigation">
    <div class="flex items-center justify-between py-4 lg:py-5">

      <!-- Logo - Prominently Sized -->
      <a href="/" class="flex items-center group flex-shrink-0">
        <div class="relative">
          <img
            src="/images/guardian-logo.jpg"
            alt="Guardian Reinsurance Brokers"
            class="h-16 sm:h-20 lg:h-24 w-auto object-contain transition-all duration-300 group-hover:scale-[1.02]"
          />
          <!-- Subtle gold underline on hover -->
          <div class="absolute -bottom-1 left-0 right-0 h-0.5 bg-gradient-to-r from-guardian-gold via-guardian-gold to-transparent scale-x-0 group-hover:scale-x-100 transition-transform duration-500 origin-left"></div>
        </div>
      </a>

      <!-- Desktop Navigation - Elegant Serif Style -->
      <div class="hidden lg:flex items-center">
        <div class="flex items-center gap-1">
          {navigation.map((item) => (
            <a
              href={item.url}
              class={`group relative px-5 py-3 text-[15px] font-medium tracking-wide transition-colors duration-300
                ${currentPath === item.url || currentPath.startsWith(item.url + '/')
                  ? 'text-guardian-green'
                  : 'text-gray-700 hover:text-guardian-green'
                }`}
            >
              <span class="relative z-10 font-serif">{item.title}</span>
              <!-- Elegant underline animation -->
              <span
                class={`absolute bottom-1 left-5 right-5 h-[2px] bg-guardian-gold transition-transform duration-300 origin-left
                  ${currentPath === item.url || currentPath.startsWith(item.url + '/')
                    ? 'scale-x-100'
                    : 'scale-x-0 group-hover:scale-x-100'
                  }`}
              ></span>
            </a>
          ))}
        </div>

        <!-- Divider -->
        <div class="w-px h-8 bg-gray-200 mx-4"></div>

        <!-- Phone with refined styling -->
        <a
          href="tel:+260211258883"
          class="flex items-center gap-2 text-sm text-gray-600 hover:text-guardian-green transition-colors group"
        >
          <div class="w-8 h-8 rounded-full bg-guardian-green/5 flex items-center justify-center group-hover:bg-guardian-green/10 transition-colors">
            <svg class="w-4 h-4 text-guardian-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
          </div>
          <span class="font-medium">+260 211 258 883</span>
        </a>

        <!-- CTA Button - Premium Gold Accent -->
        <a
          href="/connect"
          class="ml-5 inline-flex items-center gap-2 px-6 py-2.5 bg-guardian-green text-white text-sm font-semibold rounded-full hover:bg-guardian-green-dark transition-all duration-300 hover:shadow-lg hover:shadow-guardian-green/20 group"
        >
          <span>Request Quote</span>
          <svg class="w-4 h-4 transition-transform group-hover:translate-x-0.5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>

      <!-- Mobile Menu Button - Refined -->
      <button
        id="mobile-menu-button"
        class="lg:hidden relative w-12 h-12 rounded-full bg-guardian-green/5 hover:bg-guardian-green/10 flex items-center justify-center transition-colors"
        aria-label="Open menu"
        aria-expanded="false"
        aria-controls="mobile-menu"
      >
        <!-- Hamburger icon -->
        <div id="hamburger-icon" class="w-5 h-5 flex flex-col justify-center items-center gap-1.5">
          <span class="w-5 h-0.5 bg-guardian-green rounded-full transition-all"></span>
          <span class="w-4 h-0.5 bg-guardian-green rounded-full transition-all"></span>
          <span class="w-5 h-0.5 bg-guardian-green rounded-full transition-all"></span>
        </div>
        <!-- Close icon (hidden by default) -->
        <svg id="close-icon" class="w-5 h-5 hidden text-guardian-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12" />
        </svg>
      </button>
    </div>
  </nav>

  <!-- Mobile Navigation - Elegant Full-Screen Overlay -->
  <div
    id="mobile-menu"
    class="lg:hidden fixed inset-0 top-[108px] bg-white z-40 hidden overflow-y-auto"
  >
    <div class="container py-8">
      <!-- Navigation Links -->
      <nav class="space-y-1">
        {navigation.map((item, index) => (
          <a
            href={item.url}
            class={`mobile-nav-item group flex items-center justify-between px-4 py-4 rounded-xl transition-all duration-300
              ${currentPath === item.url || currentPath.startsWith(item.url + '/')
                ? 'bg-guardian-green/5 text-guardian-green'
                : 'text-gray-800 hover:bg-gray-50'
              }`}
            style={`animation-delay: ${index * 50}ms`}
          >
            <span class="text-xl font-serif font-medium">{item.title}</span>
            <svg class="w-5 h-5 text-guardian-gold opacity-0 group-hover:opacity-100 transition-opacity" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
            </svg>
          </a>
        ))}
      </nav>

      <!-- Divider -->
      <div class="my-8 border-t border-gray-100"></div>

      <!-- Contact Section -->
      <div class="space-y-4">
        <p class="text-xs uppercase tracking-widest text-gray-400 font-medium px-4">Get in Touch</p>

        <a
          href="tel:+260211258883"
          class="flex items-center gap-4 px-4 py-4 rounded-xl hover:bg-gray-50 transition-colors"
        >
          <div class="w-12 h-12 rounded-full bg-guardian-green/10 flex items-center justify-center">
            <svg class="w-5 h-5 text-guardian-green" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 5a2 2 0 012-2h3.28a1 1 0 01.948.684l1.498 4.493a1 1 0 01-.502 1.21l-2.257 1.13a11.042 11.042 0 005.516 5.516l1.13-2.257a1 1 0 011.21-.502l4.493 1.498a1 1 0 01.684.949V19a2 2 0 01-2 2h-1C9.716 21 3 14.284 3 6V5z"/>
            </svg>
          </div>
          <div>
            <p class="text-sm text-gray-500">Call us directly</p>
            <p class="text-lg font-semibold text-gray-900">+260 211 258 883</p>
          </div>
        </a>

        <a
          href="mailto:info@guardianreinsurance.co.zm"
          class="flex items-center gap-4 px-4 py-4 rounded-xl hover:bg-gray-50 transition-colors"
        >
          <div class="w-12 h-12 rounded-full bg-guardian-gold/10 flex items-center justify-center">
            <svg class="w-5 h-5 text-guardian-gold" fill="none" stroke="currentColor" viewBox="0 0 24 24">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
            </svg>
          </div>
          <div>
            <p class="text-sm text-gray-500">Email us</p>
            <p class="text-lg font-semibold text-gray-900">info@guardianreinsurance.co.zm</p>
          </div>
        </a>
      </div>

      <!-- CTA Button -->
      <div class="mt-8 px-4">
        <a
          href="/connect"
          class="flex items-center justify-center gap-2 w-full py-4 bg-guardian-green text-white text-lg font-semibold rounded-2xl hover:bg-guardian-green-dark transition-colors"
        >
          <span>Request a Quote</span>
          <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 8l4 4m0 0l-4 4m4-4H3"/>
          </svg>
        </a>
      </div>

      <!-- Minerva Partnership Badge -->
      <div class="mt-8 mx-4 p-4 bg-gray-50 rounded-xl text-center">
        <p class="text-xs text-gray-500 mb-2">Endorsed Partner of</p>
        <a
          href="https://www.minerva.co.zw/"
          target="_blank"
          rel="noopener noreferrer"
          class="text-guardian-gold font-semibold hover:underline"
        >
          Minerva Re
        </a>
      </div>
    </div>
  </div>
</header>

<style>
  /* Mobile nav item entrance animation */
  @keyframes slideInFromRight {
    from {
      opacity: 0;
      transform: translateX(20px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  #mobile-menu:not(.hidden) .mobile-nav-item {
    animation: slideInFromRight 0.4s cubic-bezier(0.16, 1, 0.3, 1) forwards;
    opacity: 0;
  }

  /* Hamburger animation */
  #mobile-menu-button[aria-expanded="true"] #hamburger-icon span:nth-child(1) {
    transform: translateY(6px) rotate(45deg);
  }
  #mobile-menu-button[aria-expanded="true"] #hamburger-icon span:nth-child(2) {
    opacity: 0;
    transform: scaleX(0);
  }
  #mobile-menu-button[aria-expanded="true"] #hamburger-icon span:nth-child(3) {
    transform: translateY(-6px) rotate(-45deg);
  }
</style>

<script>
  function setupMobileMenu() {
    const button = document.getElementById('mobile-menu-button');
    const menu = document.getElementById('mobile-menu');
    const hamburgerIcon = document.getElementById('hamburger-icon');
    const closeIcon = document.getElementById('close-icon');

    if (!button || !menu || !hamburgerIcon || !closeIcon) return;

    // Remove any existing listeners to prevent duplicates
    const newButton = button.cloneNode(true);
    button.parentNode?.replaceChild(newButton, button);

    // Get new references after cloning
    const newHamburgerIcon = newButton.querySelector('#hamburger-icon');
    const newCloseIcon = newButton.querySelector('#close-icon');

    newButton.addEventListener('click', () => {
      const isCurrentlyHidden = menu.classList.contains('hidden');

      if (isCurrentlyHidden) {
        // Open menu
        menu.classList.remove('hidden');
        document.body.style.overflow = 'hidden';
        newButton.setAttribute('aria-expanded', 'true');
        newButton.setAttribute('aria-label', 'Close menu');
      } else {
        // Close menu
        menu.classList.add('hidden');
        document.body.style.overflow = '';
        newButton.setAttribute('aria-expanded', 'false');
        newButton.setAttribute('aria-label', 'Open menu');
      }
    });

    // Close menu when clicking a link
    menu.querySelectorAll('a').forEach(link => {
      link.addEventListener('click', () => {
        menu.classList.add('hidden');
        document.body.style.overflow = '';
        newButton.setAttribute('aria-expanded', 'false');
        newButton.setAttribute('aria-label', 'Open menu');
      });
    });
  }

  // Run on initial load
  document.addEventListener('DOMContentLoaded', setupMobileMenu);
  // Run on Astro page navigation
  document.addEventListener('astro:page-load', setupMobileMenu);
</script>
